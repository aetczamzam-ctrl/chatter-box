<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
    }
    .container {
      max-width: 1100px;
      margin: 30px auto;
      padding: 20px;
      background: #fff;
      border-radius: 6px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: red;
      margin-bottom: 20px;
    }
    .field {
      text-align: center;
      margin-bottom: 20px;
    }
    input, button, select {
      padding: 10px 14px;
      font-size: 15px;
      margin: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background: #4CAF50;
      color: #fff;
      cursor: pointer;
      border: none;
    }
    button:hover {
      background: #43a047;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }
    video {
      width: 130px;
      height: 80px;
    }
  </style>
</head>

<body>
<div class="container">
  <h1>Admin Upload Panel</h1>

  <div class="field">
    <input type="file" id="fileInput" accept="">
    <input type="text" id="rcInput" placeholder="Enter RC Number">
    <button onclick="uploadVideo()">Upload</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>Status</th>
        <th>RC No</th>
        <th>Date</th>
        <th>Video</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.12.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.12.1/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.12.1/firebase-storage-compat.js"></script>

<script>
/* ðŸ”¥ FIREBASE CONFIG (CORRECT) */
const firebaseConfig = {
  apiKey: "AIzaSyD4ss64NXL7HA0a0KpwArNf2BMy5hmH2Z0",
  authDomain: "chatsapp-4e639.firebaseapp.com",
  databaseURL: "https://chatsapp-4e639-default-rtdb.firebaseio.com",
  projectId: "chatsapp-4e639",
  storageBucket: "chatsapp-4e639.appspot.app",
  messagingSenderId: "956897440153",
  appId: "1:956897440153:web:7cd6317f93b514c7d76308"
};

firebase.initializeApp(firebaseConfig);

const db = firebase.database();
const storage = firebase.storage();
const uploadsRef = db.ref("Uploads");

/* âœ… UPLOAD FUNCTION */
function uploadVideo() {
  console.log("Upload clicked");

  const file = document.getElementById("fileInput").files[0];
  const rc = document.getElementById("rcInput").value.trim();

  if (!file || !rc) {
    alert("File & RC number required");
    return;
  }

  const fileName = Date.now() + "_" + file.name;
  const storageRef = storage.ref("videos/" + fileName);

  storageRef.put(file)
    .then(snap => snap.ref.getDownloadURL())
    .then(url => {
      uploadsRef.push({
        rc: rc,
        videoUrl: url,
        status: "Pending",
        time: new Date().toISOString()
      });

      alert("Upload Successful âœ…");
      document.getElementById("fileInput").value = "";
      document.getElementById("rcInput").value = "";
    })
    .catch(err => {
      console.error(err);
      alert("Upload failed âŒ " + err.message);
    });
}

/* âœ… LOAD DATA */
uploadsRef.on("value", snap => {
  const data = snap.val();
  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = "";

  if (!data) return;

  Object.keys(data).reverse().forEach(key => {
    const item = data[key];

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${item.status}</td>
      <td>${item.rc}</td>
      <td>${new Date(item.time).toLocaleString()}</td>
      <td>
        <video controls>
          <source src="${item.videoUrl}" type="video/mp4">
        </video>
      </td>
      <td>
        <button onclick="deleteItem('${key}')">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
});

function deleteItem(key) {
  if (confirm("Delete this record?")) {
    uploadsRef.child(key).remove();
  }
}
</script>
</body>
</html>
